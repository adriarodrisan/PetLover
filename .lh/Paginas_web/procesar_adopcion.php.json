{
    "sourceFile": "Paginas_web/procesar_adopcion.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 12,
            "patches": [
                {
                    "date": 1743584046400,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1743584095673,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,8 +30,14 @@\n $dni= trim($_POST['dni']);\r\n $direccion= trim($_POST['direccion']);\r\n $telefono= trim($_POST['telefono']);\r\n $correo= trim($_POST['correo']);\r\n+\r\n+$nombre_animal = trim($_POST['nombre_animal']);\r\n+$chip = trim($_POST['chip']);\r\n+$especie = $_POST['especie'];\r\n+$raza = trim($_POST['raza']);\r\n+$sexo = $_POST['sexo'];\r\n //revisar que los campos no sean null\r\n //echo $dni.\" \".$correo;\r\n if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n"
                },
                {
                    "date": 1743584333185,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,8 +36,11 @@\n $chip = trim($_POST['chip']);\r\n $especie = $_POST['especie'];\r\n $raza = trim($_POST['raza']);\r\n $sexo = $_POST['sexo'];\r\n+\r\n+// Recibir los compromisos (implode es una funcion que devuelve un string de los elementos de un array)\r\n+$compromisos = isset($_POST['compromisos']) ? implode(\", \", $_POST['compromisos']) : '';\r\n //revisar que los campos no sean null\r\n //echo $dni.\" \".$correo;\r\n if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n"
                },
                {
                    "date": 1743585333859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,6 @@\n <?php\r\n+//ESTE FORMULARIO ESTARÁ METIDO DENTRO DE LAS IMAGENES AL DARLE MAS INFORMACION. (Talvez tambien metemos un campo donde explicamos info de cada animal)\r\n ini_set('display_errors', 1);\r\n \r\n ini_set('display_startup_errors', 1);\r\n \r\n@@ -41,9 +42,9 @@\n // Recibir los compromisos (implode es una funcion que devuelve un string de los elementos de un array)\r\n $compromisos = isset($_POST['compromisos']) ? implode(\", \", $_POST['compromisos']) : '';\r\n //revisar que los campos no sean null\r\n //echo $dni.\" \".$correo;\r\n-if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n     exit;\r\n }\r\n //verificar las contraseñas que sean iguales\r\n@@ -104,5 +105,6 @@\n }else{\r\n    echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n    exit;\r\n }\r\n-?>\n\\ No newline at end of file\n+?>\r\n+\r\n"
                },
                {
                    "date": 1743585915311,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,109 @@\n+<?php\r\n+//ESTE FORMULARIO ESTARÁ METIDO DENTRO DE LAS IMAGENES AL DARLE MAS INFORMACION. (Talvez tambien metemos un campo donde explicamos info de cada animal)\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    echo 'Falló la conixion: ' . $e->getMessage(); \r\n+}\r\n+/*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n+$database = 'protectora'; // nombre bd\r\n+$username = 'petlove'; // Usuario bd\r\n+$password = 'mascota'; // pass base de datos\r\n+// creamos conexion\r\n+//if (function_exists('mysqli_connect')){\r\n+//    echo \"mysqli yes\";\r\n+//}\r\n+//echo \"intentamos conexion\" . $servername . $database.$username.$password;\r\n+$conn = new mysqli($servername, $username, $password, $database);\r\n+//verificamos la conexion\r\n+//echo \"este no se muestra\";\r\n+if ($conn->connect_errno){\r\n+    echo 'fallo al conectar';\r\n+    die(\"Conexion fallida: \". $conn->connect_error);\r\n+}*/\r\n+$nombre= trim($_POST['nombre']);\r\n+$dni= trim($_POST['dni']);\r\n+$direccion= trim($_POST['direccion']);\r\n+$telefono= trim($_POST['telefono']);\r\n+$correo= trim($_POST['correo']);\r\n+\r\n+$nombre_animal = trim($_POST['nombre_animal']);\r\n+$chip = trim($_POST['chip']);\r\n+$especie = $_POST['especie'];\r\n+$raza = trim($_POST['raza']);\r\n+$sexo = $_POST['sexo'];\r\n+\r\n+// Recibir los compromisos (implode es una funcion que devuelve un string de los elementos de un array)\r\n+$compromisos = isset($_POST['compromisos']) ? implode(\", \", $_POST['compromisos']) : '';\r\n+//revisar que los campos no sean null\r\n+if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n+    echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n+    exit;\r\n+}\r\n+//verificar las contraseñas que sean iguales\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"Las cotraseñas no coinciden.\";\r\n+    exit;\r\n+}\r\n+//verificar si el mail esta registrado\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+//$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n+//$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n+//if (mysqli_num_rows($correo_verificado_usuario)>0){\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n+    exit;\r\n+}\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+//$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n+//$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n+//if (mysqli_num_rows($correo_verificado_protectora)>0){\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n+if ($registrar_usuarios){\r\n+    $_SESSION['usuario'] = $nombre;\r\n+    $_SESSION['rol'] = 'protectora';\r\n+//if (mysqli_query($conn, $registrar_usuarios)){\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"/Paginas_web/Home_Petlover.html\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\r\n+\r\n"
                },
                {
                    "date": 1743601102134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,39 +10,24 @@\n     $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n }catch (PDOException $e){\r\n     echo 'Falló la conixion: ' . $e->getMessage(); \r\n }\r\n-/*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n-$database = 'protectora'; // nombre bd\r\n-$username = 'petlove'; // Usuario bd\r\n-$password = 'mascota'; // pass base de datos\r\n-// creamos conexion\r\n-//if (function_exists('mysqli_connect')){\r\n-//    echo \"mysqli yes\";\r\n-//}\r\n-//echo \"intentamos conexion\" . $servername . $database.$username.$password;\r\n-$conn = new mysqli($servername, $username, $password, $database);\r\n-//verificamos la conexion\r\n-//echo \"este no se muestra\";\r\n-if ($conn->connect_errno){\r\n-    echo 'fallo al conectar';\r\n-    die(\"Conexion fallida: \". $conn->connect_error);\r\n-}*/\r\n+//persona\r\n $nombre= trim($_POST['nombre']);\r\n $dni= trim($_POST['dni']);\r\n $direccion= trim($_POST['direccion']);\r\n $telefono= trim($_POST['telefono']);\r\n $correo= trim($_POST['correo']);\r\n-\r\n+//animal\r\n $nombre_animal = trim($_POST['nombre_animal']);\r\n $chip = trim($_POST['chip']);\r\n $especie = $_POST['especie'];\r\n $raza = trim($_POST['raza']);\r\n $sexo = $_POST['sexo'];\r\n \r\n // Recibir los compromisos (implode es una funcion que devuelve un string de los elementos de un array)\r\n $compromisos = isset($_POST['compromisos']) ? implode(\", \", $_POST['compromisos']) : '';\r\n-//revisar que los campos no sean null\r\n+//Validamos que los campos fueron rellenados\r\n if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n     exit;\r\n }\r\n@@ -54,135 +39,23 @@\n //verificar si el mail esta registrado\r\n $registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n $registros_adoptate ->bindParam(':correo', $correo);\r\n $registros_adoptate ->execute();\r\n-//$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n-//$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n-//if (mysqli_num_rows($correo_verificado_usuario)>0){\r\n+\r\n if ($registros_adoptate->rowCount() > 0) {\r\n     echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n     exit;\r\n }\r\n $registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n $registros_protectora ->bindParam(':correo', $correo);\r\n $registros_protectora ->execute();\r\n-//$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n-//$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n-//if (mysqli_num_rows($correo_verificado_protectora)>0){\r\n-if ($registros_protectora->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n-    exit;\r\n-}\r\n-//hashear pass\r\n-$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n-$registrar_usuarios = $db->prepare(\"INSERT INTO refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n-$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n-$registrar_usuarios ->bindParam(':correo', $correo);\r\n-$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n-$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n-$registrar_usuarios ->execute();\r\n-//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n-if ($registrar_usuarios){\r\n-    $_SESSION['usuario'] = $nombre;\r\n-    $_SESSION['rol'] = 'protectora';\r\n-//if (mysqli_query($conn, $registrar_usuarios)){\r\n-    echo '<!DOCTYPE html>\r\n-            <html lang=\"es\">\r\n-                <head>\r\n-                    <meta charset=\"UTF-8\">\r\n-                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n-                    <title>Registro Exitoso</title>\r\n-                </head>\r\n-                <body class=\"cuerpo\">\r\n-                    <div class=\"alertas\">\r\n-                        <h1>Registro Exitoso</h1>\r\n-                        <a href=\"/Paginas_web/Home_Petlover.html\"> Ir al inicio</a>\r\n-                    </div>\r\n-                </body>\r\n-            </html>\r\n-            ';\r\n-            exit;\r\n-}else{\r\n-   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n-   exit;\r\n-}\r\n-?>\r\n \r\n-<?php\r\n-//ESTE FORMULARIO ESTARÁ METIDO DENTRO DE LAS IMAGENES AL DARLE MAS INFORMACION. (Talvez tambien metemos un campo donde explicamos info de cada animal)\r\n-ini_set('display_errors', 1);\r\n-\r\n-ini_set('display_startup_errors', 1);\r\n-\r\n-error_reporting(E_ALL);\r\n-try {\r\n-    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n-    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n-}catch (PDOException $e){\r\n-    echo 'Falló la conixion: ' . $e->getMessage(); \r\n-}\r\n-/*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n-$database = 'protectora'; // nombre bd\r\n-$username = 'petlove'; // Usuario bd\r\n-$password = 'mascota'; // pass base de datos\r\n-// creamos conexion\r\n-//if (function_exists('mysqli_connect')){\r\n-//    echo \"mysqli yes\";\r\n-//}\r\n-//echo \"intentamos conexion\" . $servername . $database.$username.$password;\r\n-$conn = new mysqli($servername, $username, $password, $database);\r\n-//verificamos la conexion\r\n-//echo \"este no se muestra\";\r\n-if ($conn->connect_errno){\r\n-    echo 'fallo al conectar';\r\n-    die(\"Conexion fallida: \". $conn->connect_error);\r\n-}*/\r\n-$nombre= trim($_POST['nombre']);\r\n-$dni= trim($_POST['dni']);\r\n-$direccion= trim($_POST['direccion']);\r\n-$telefono= trim($_POST['telefono']);\r\n-$correo= trim($_POST['correo']);\r\n-\r\n-$nombre_animal = trim($_POST['nombre_animal']);\r\n-$chip = trim($_POST['chip']);\r\n-$especie = $_POST['especie'];\r\n-$raza = trim($_POST['raza']);\r\n-$sexo = $_POST['sexo'];\r\n-\r\n-// Recibir los compromisos (implode es una funcion que devuelve un string de los elementos de un array)\r\n-$compromisos = isset($_POST['compromisos']) ? implode(\", \", $_POST['compromisos']) : '';\r\n-//revisar que los campos no sean null\r\n-//echo $dni.\" \".$correo;\r\n-if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n-    echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n-    exit;\r\n-}\r\n-//verificar las contraseñas que sean iguales\r\n-if ($contrasena !== $confirmar_contrasena){\r\n-    echo \"Las cotraseñas no coinciden.\";\r\n-    exit;\r\n-}\r\n-//verificar si el mail esta registrado\r\n-$registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n-$registros_adoptate ->bindParam(':correo', $correo);\r\n-$registros_adoptate ->execute();\r\n-//$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n-//$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n-//if (mysqli_num_rows($correo_verificado_usuario)>0){\r\n-if ($registros_adoptate->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n-    exit;\r\n-}\r\n-$registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n-$registros_protectora ->bindParam(':correo', $correo);\r\n-$registros_protectora ->execute();\r\n-//$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n-//$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n-//if (mysqli_num_rows($correo_verificado_protectora)>0){\r\n if ($registros_protectora->rowCount() > 0) {\r\n     echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n     exit;\r\n }\r\n+$registrar_adopcion = $db->prepare(\"INSERT INTO adopciones (nombre_adoptante, dni, direccion, telefono, correo, nombre_animal, chip, especie, raza, sexo, compromisos) \r\n+                                    VALUES (:nombre, :dni, :direccion, :telefono, :correo, :nombre_animal, :chip, :especie, :raza, :sexo, :compromisos)\");\r\n //hashear pass\r\n $contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n $registrar_usuarios = $db->prepare(\"INSERT INTO refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n $registrar_usuarios ->bindParam(':nombre', $nombre);\r\n"
                },
                {
                    "date": 1743601108632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,8 +52,9 @@\n if ($registros_protectora->rowCount() > 0) {\r\n     echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n     exit;\r\n }\r\n+//datos insertado\r\n $registrar_adopcion = $db->prepare(\"INSERT INTO adopciones (nombre_adoptante, dni, direccion, telefono, correo, nombre_animal, chip, especie, raza, sexo, compromisos) \r\n                                     VALUES (:nombre, :dni, :direccion, :telefono, :correo, :nombre_animal, :chip, :especie, :raza, :sexo, :compromisos)\");\r\n //hashear pass\r\n $contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n"
                },
                {
                    "date": 1743601671154,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,15 +55,28 @@\n }\r\n //datos insertado\r\n $registrar_adopcion = $db->prepare(\"INSERT INTO adopciones (nombre_adoptante, dni, direccion, telefono, correo, nombre_animal, chip, especie, raza, sexo, compromisos) \r\n                                     VALUES (:nombre, :dni, :direccion, :telefono, :correo, :nombre_animal, :chip, :especie, :raza, :sexo, :compromisos)\");\r\n-//hashear pass\r\n $contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n-$registrar_usuarios = $db->prepare(\"INSERT INTO refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n-$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n-$registrar_usuarios ->bindParam(':correo', $correo);\r\n-$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n-$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+\r\n+$registrar_adopcion ->bindParam(':nombre', $nombre);\r\n+$registrar_adopcion ->bindParam(':dni', $dni);\r\n+$registrar_adopcion ->bindParam(':direccion', $direccion);\r\n+$registrar_adopcion ->bindParam(':telefono', $telefono);\r\n+$registrar_adopcion ->bindParam(':correo', $correo);\r\n+$registrar_adopcion ->bindParam(':nombre_animal', $nombre_animal);\r\n+$registrar_adopcion ->bindParam(':chip', $chip);\r\n+$registrar_adopcion ->bindParam(':especie', $especie);\r\n+$registrar_adopcion ->bindParam(':raza', $raza);\r\n+$registrar_adopcion ->bindParam(':sexo', $raza);\r\n+nombre_animal\r\n+chip\r\n+especie \r\n+raza \r\n+sexo  \r\n+compromisos \r\n+\r\n+\r\n $registrar_usuarios ->execute();\r\n //$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n if ($registrar_usuarios){\r\n     $_SESSION['usuario'] = $nombre;\r\n"
                },
                {
                    "date": 1743601749225,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,17 +66,13 @@\n $registrar_adopcion ->bindParam(':nombre_animal', $nombre_animal);\r\n $registrar_adopcion ->bindParam(':chip', $chip);\r\n $registrar_adopcion ->bindParam(':especie', $especie);\r\n $registrar_adopcion ->bindParam(':raza', $raza);\r\n-$registrar_adopcion ->bindParam(':sexo', $raza);\r\n-nombre_animal\r\n-chip\r\n-especie \r\n-raza \r\n-sexo  \r\n-compromisos \r\n+$registrar_adopcion ->bindParam(':sexo', $sexo);\r\n+$registrar_adopcion ->bindParam(':compromisos', $compromisos);\r\n \r\n \r\n+\r\n $registrar_usuarios ->execute();\r\n //$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n if ($registrar_usuarios){\r\n     $_SESSION['usuario'] = $nombre;\r\n"
                },
                {
                    "date": 1743601790235,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,9 +71,9 @@\n $registrar_adopcion ->bindParam(':compromisos', $compromisos);\r\n \r\n \r\n \r\n-$registrar_usuarios ->execute();\r\n+$registrar_adopcion ->execute();\r\n //$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n if ($registrar_usuarios){\r\n     $_SESSION['usuario'] = $nombre;\r\n     $_SESSION['rol'] = 'protectora';\r\n"
                },
                {
                    "date": 1743601858911,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,13 +82,13 @@\n             <html lang=\"es\">\r\n                 <head>\r\n                     <meta charset=\"UTF-8\">\r\n                     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n-                    <title>Registro Exitoso</title>\r\n+                    <title>Registro Exitoso!</title>\r\n                 </head>\r\n-                <body class=\"cuerpo\">\r\n+                <body>\r\n                     <div class=\"alertas\">\r\n-                        <h1>Registro Exitoso</h1>\r\n+                        <h1>Adopción registrada exitosamente</h1>\r\n                         <a href=\"/Paginas_web/Home_Petlover.html\"> Ir al inicio</a>\r\n                     </div>\r\n                 </body>\r\n             </html>\r\n"
                },
                {
                    "date": 1743687679451,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,22 +30,18 @@\n if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n     exit;\r\n }\r\n-//verificar las contraseñas que sean iguales\r\n-if ($contrasena !== $confirmar_contrasena){\r\n-    echo \"Las cotraseñas no coinciden.\";\r\n-    exit;\r\n-}\r\n+/*\r\n //verificar si el mail esta registrado\r\n $registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n $registros_adoptate ->bindParam(':correo', $correo);\r\n $registros_adoptate ->execute();\r\n \r\n if ($registros_adoptate->rowCount() > 0) {\r\n     echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n     exit;\r\n-}\r\n+}*/\r\n $registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n $registros_protectora ->bindParam(':correo', $correo);\r\n $registros_protectora ->execute();\r\n \r\n"
                },
                {
                    "date": 1747233149075,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,23 +4,25 @@\n \r\n ini_set('display_startup_errors', 1);\r\n \r\n error_reporting(E_ALL);\r\n+require_once 'mail_contrato.php';\r\n try {\r\n     $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n     $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n }catch (PDOException $e){\r\n     echo 'Falló la conixion: ' . $e->getMessage(); \r\n }\r\n //persona\r\n $nombre= trim($_POST['nombre']);\r\n+$apellido= trim($_POST['apellido']);\r\n $dni= trim($_POST['dni']);\r\n $direccion= trim($_POST['direccion']);\r\n $telefono= trim($_POST['telefono']);\r\n $correo= trim($_POST['correo']);\r\n //animal\r\n $nombre_animal = trim($_POST['nombre_animal']);\r\n-$chip = trim($_POST['chip']);\r\n+//$chip = trim($_POST['chip']);\r\n $especie = $_POST['especie'];\r\n $raza = trim($_POST['raza']);\r\n $sexo = $_POST['sexo'];\r\n \r\n@@ -30,52 +32,90 @@\n if(empty($nombre) || empty($dni) || empty($direccion) || empty($telefono) || empty($correo)){\r\n     echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n     exit;\r\n }\r\n-/*\r\n-//verificar si el mail esta registrado\r\n-$registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n-$registros_adoptate ->bindParam(':correo', $correo);\r\n-$registros_adoptate ->execute();\r\n \r\n-if ($registros_adoptate->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n+//verificar si el animal esta guardado en la base de datos\r\n+$consultaAnimal = $db->prepare(\"SELECT ID,FechaNacimiento FROM animal WHERE Nombre = :nombre_animal LIMIT 1\");\r\n+$consultaAnimal ->bindParam(':nombre_animal', $nombre_animal);\r\n+$consultaAnimal ->execute();\r\n+\r\n+if ($consultaAnimal->rowCount() < 1) {\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <title>Error 453</title>\r\n+                </head>\r\n+                <body>\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Error 453</h1>\r\n+                        <h1>Error con el animal</h1>\r\n+                        <p>No hay Animal con este nombre, Intentalo revisar que no te has equivocado</p>\r\n+                        <a href=\"/Paginas_web/Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n     exit;\r\n+}\r\n+$animal = $consultaAnimal->fetch(PDO::FETCH_ASSOC);\r\n+$fechaNacimiento = $animal['FechaNacimiento'];\r\n+function calcularEdad($fechaNacimiento) {\r\n+    $fechaNac = new DateTime($fechaNacimiento);\r\n+    $hoy = new DateTime();\r\n+    $edad = $hoy ->diff($fechaNac);\r\n+    return ($edad->y > 0 ? $edad->y . ' años': '') . ($edad->m > 0 ? ' y ' . $edad->m. ' meses' : '');\r\n+}\r\n+$edad = calcularEdad($fechaNacimiento);\r\n+/*$id_adoptante = $db->prepare(\"SELECT ID FROM adoptante WHERE Nombre = :nombre_adoptante\");\r\n+$id_adoptante ->bindParam(':nombre_adoptante', $nombre_adoptante);\r\n+$id_adoptante ->execute();\r\n+\r\n+if ($id_adoptante->rowCount() < 1) {\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <title>Error 454</title>\r\n+                </head>\r\n+                <body>\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Error 454</h1>\r\n+                        <h1>Error con el Nombre</h1>\r\n+                        <p>No hay Usuario con este nombre, Intentalo revisar que no te has equivocado o no estas registrado</p>\r\n+                        <a href=\"Inicio_Sesion.html\"> Ir al registro</a>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+    exit;\r\n }*/\r\n-$registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n-$registros_protectora ->bindParam(':correo', $correo);\r\n-$registros_protectora ->execute();\r\n \r\n-if ($registros_protectora->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n-    exit;\r\n-}\r\n //datos insertado\r\n-$registrar_adopcion = $db->prepare(\"INSERT INTO adopciones (nombre_adoptante, dni, direccion, telefono, correo, nombre_animal, chip, especie, raza, sexo, compromisos) \r\n-                                    VALUES (:nombre, :dni, :direccion, :telefono, :correo, :nombre_animal, :chip, :especie, :raza, :sexo, :compromisos)\");\r\n-$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n-\r\n+$registrar_adopcion = $db->prepare(\"INSERT INTO Adopciones (nombre_adoptante, apellido_adoptante, dni, direccion, telefono, correo, nombre_animal, especie, raza, sexo, compromisos) \r\n+                                    VALUES (:nombre, :apellido, :dni, :direccion, :telefono, :correo, :nombre_animal, :especie, :raza, :sexo, :compromisos)\");\r\n $registrar_adopcion ->bindParam(':nombre', $nombre);\r\n+$registrar_adopcion ->bindParam(':apellido', $apellido);\r\n $registrar_adopcion ->bindParam(':dni', $dni);\r\n $registrar_adopcion ->bindParam(':direccion', $direccion);\r\n $registrar_adopcion ->bindParam(':telefono', $telefono);\r\n $registrar_adopcion ->bindParam(':correo', $correo);\r\n $registrar_adopcion ->bindParam(':nombre_animal', $nombre_animal);\r\n-$registrar_adopcion ->bindParam(':chip', $chip);\r\n+//$registrar_adopcion ->bindParam(':chip', $chip);\r\n $registrar_adopcion ->bindParam(':especie', $especie);\r\n $registrar_adopcion ->bindParam(':raza', $raza);\r\n $registrar_adopcion ->bindParam(':sexo', $sexo);\r\n $registrar_adopcion ->bindParam(':compromisos', $compromisos);\r\n-\r\n-\r\n-\r\n $registrar_adopcion ->execute();\r\n //$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n-if ($registrar_usuarios){\r\n-    $_SESSION['usuario'] = $nombre;\r\n-    $_SESSION['rol'] = 'protectora';\r\n+if ($registrar_adopcion){\r\n //if (mysqli_query($conn, $registrar_usuarios)){\r\n-    echo '<!DOCTYPE html>\r\n+    enviarCorreoContrato($correo,$nombre,$apellido,$dni,$direccion,$telefono,$nombre_animal,$especie,$raza,$edad,$sexo,$compromisos);    \r\n+        echo '<!DOCTYPE html>\r\n             <html lang=\"es\">\r\n                 <head>\r\n                     <meta charset=\"UTF-8\">\r\n                     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n@@ -83,9 +123,9 @@\n                 </head>\r\n                 <body>\r\n                     <div class=\"alertas\">\r\n                         <h1>Adopción registrada exitosamente</h1>\r\n-                        <a href=\"/Paginas_web/Home_Petlover.html\"> Ir al inicio</a>\r\n+                        <a href=\"/Paginas_web/Home_Petlover.php\"> Ir al inicio</a>\r\n                     </div>\r\n                 </body>\r\n             </html>\r\n             ';\r\n"
                }
            ],
            "date": 1743584046400,
            "name": "Commit-0",
            "content": "<?php\r\nini_set('display_errors', 1);\r\n\r\nini_set('display_startup_errors', 1);\r\n\r\nerror_reporting(E_ALL);\r\ntry {\r\n    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n}catch (PDOException $e){\r\n    echo 'Falló la conixion: ' . $e->getMessage(); \r\n}\r\n/*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n$database = 'protectora'; // nombre bd\r\n$username = 'petlove'; // Usuario bd\r\n$password = 'mascota'; // pass base de datos\r\n// creamos conexion\r\n//if (function_exists('mysqli_connect')){\r\n//    echo \"mysqli yes\";\r\n//}\r\n//echo \"intentamos conexion\" . $servername . $database.$username.$password;\r\n$conn = new mysqli($servername, $username, $password, $database);\r\n//verificamos la conexion\r\n//echo \"este no se muestra\";\r\nif ($conn->connect_errno){\r\n    echo 'fallo al conectar';\r\n    die(\"Conexion fallida: \". $conn->connect_error);\r\n}*/\r\n$nombre= trim($_POST['nombre']);\r\n$dni= trim($_POST['dni']);\r\n$direccion= trim($_POST['direccion']);\r\n$telefono= trim($_POST['telefono']);\r\n$correo= trim($_POST['correo']);\r\n//revisar que los campos no sean null\r\n//echo $dni.\" \".$correo;\r\nif(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n    echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n    exit;\r\n}\r\n//verificar las contraseñas que sean iguales\r\nif ($contrasena !== $confirmar_contrasena){\r\n    echo \"Las cotraseñas no coinciden.\";\r\n    exit;\r\n}\r\n//verificar si el mail esta registrado\r\n$registros_adoptate = $db->prepare(\"SELECT * FROM adoptante WHERE Correo = :correo\");\r\n$registros_adoptate ->bindParam(':correo', $correo);\r\n$registros_adoptate ->execute();\r\n//$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n//$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n//if (mysqli_num_rows($correo_verificado_usuario)>0){\r\nif ($registros_adoptate->rowCount() > 0) {\r\n    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n    exit;\r\n}\r\n$registros_protectora = $db->prepare(\"SELECT * FROM refugio WHERE Correo = :correo\");\r\n$registros_protectora ->bindParam(':correo', $correo);\r\n$registros_protectora ->execute();\r\n//$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n//$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n//if (mysqli_num_rows($correo_verificado_protectora)>0){\r\nif ($registros_protectora->rowCount() > 0) {\r\n    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n    exit;\r\n}\r\n//hashear pass\r\n$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n$registrar_usuarios = $db->prepare(\"INSERT INTO refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n$registrar_usuarios ->bindParam(':correo', $correo);\r\n$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n$registrar_usuarios ->execute();\r\n//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\nif ($registrar_usuarios){\r\n    $_SESSION['usuario'] = $nombre;\r\n    $_SESSION['rol'] = 'protectora';\r\n//if (mysqli_query($conn, $registrar_usuarios)){\r\n    echo '<!DOCTYPE html>\r\n            <html lang=\"es\">\r\n                <head>\r\n                    <meta charset=\"UTF-8\">\r\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n                    <title>Registro Exitoso</title>\r\n                </head>\r\n                <body class=\"cuerpo\">\r\n                    <div class=\"alertas\">\r\n                        <h1>Registro Exitoso</h1>\r\n                        <a href=\"/Paginas_web/Home_Petlover.html\"> Ir al inicio</a>\r\n                    </div>\r\n                </body>\r\n            </html>\r\n            ';\r\n            exit;\r\n}else{\r\n   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n   exit;\r\n}\r\n?>"
        }
    ]
}