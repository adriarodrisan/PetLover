{
    "sourceFile": "Paginas_web/insertar_datos_registro_protectora.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1747231151086,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747346251990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n try {\r\n     $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n     $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n }catch (PDOException $e){\r\n-    echo 'Falló la conixion: ' . $e->getMessage(); \r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n }\r\n /*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n $database = 'protectora'; // nombre bd\r\n $username = 'petlove'; // Usuario bd\r\n@@ -37,23 +37,27 @@\n //echo $dni.\" \".$correo;\r\n $valido_correo= preg_match($requisitos_correo,$correo);\r\n $valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n-    echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n     exit;\r\n }\r\n //verificar las contraseñas que sean iguales\r\n if ($contrasena !== $confirmar_contrasena){\r\n-    echo \"Las cotraseñas no coinciden.\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n     exit;\r\n }\r\n \r\n if (!$valido_correo){\r\n-    echo \"El Correo no es valido.\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Correo no es valido.</div>\";\r\n     exit;\r\n }\r\n if (!$valido_contrasena){\r\n-    echo \"El Contraseña no es valido.\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Contraseña no es valido.</div>\";\r\n     exit;\r\n }\r\n //verificar si el mail esta registrado\r\n $registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n@@ -62,9 +66,10 @@\n //$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n //$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n //if (mysqli_num_rows($correo_verificado_usuario)>0){\r\n if ($registros_adoptate->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n     exit;\r\n }\r\n $registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n $registros_protectora ->bindParam(':correo', $correo);\r\n@@ -72,9 +77,10 @@\n //$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n //$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n //if (mysqli_num_rows($correo_verificado_protectora)>0){\r\n if ($registros_protectora->rowCount() > 0) {\r\n-    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n     exit;\r\n }\r\n //hashear pass\r\n $contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n@@ -85,10 +91,10 @@\n $registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n $registrar_usuarios ->execute();\r\n //$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n if ($registrar_usuarios){\r\n-setcookie(\"rol\", \"protectora\", time() + (86400 * 30), \"/\");\r\n-setcookie(\"nombre\",$nombre, time() + (86400 * 30), \"/\");\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n include 'mail_registro.php';\r\n enviarCorreosregistro($correo,$nombre);\r\n //if (mysqli_query($conn, $registrar_usuarios)){\r\n     echo '<!DOCTYPE html>\r\n"
                },
                {
                    "date": 1747346397782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,102 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+//revisar que los campos no sean null\r\n+\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+//verificar las contraseñas que sean iguales\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+//verificar si el mail esta registrado\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+//if (mysqli_query($conn, $registrar_usuarios)){\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346407738,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,103 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+//revisar que los campos no sean null\r\n+\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+//verificar las contraseñas que sean iguales\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+//verificar si el mail esta registrado\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+//if (mysqli_query($conn, $registrar_usuarios)){\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346416841,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,104 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+// Recolección y limpieza de los datos enviados por POST\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+//revisar que los campos no sean null\r\n+\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+//verificar las contraseñas que sean iguales\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+//verificar si el mail esta registrado\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+//if (mysqli_query($conn, $registrar_usuarios)){\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346428823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,105 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+// Recolección y limpieza de los datos enviados por POST\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+// Expresiones regulares para validar correo y contraseña segura\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+//revisar que los campos no sean null\r\n+\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+//verificar las contraseñas que sean iguales\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+//verificar si el mail esta registrado\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+//if (mysqli_query($conn, $registrar_usuarios)){\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346591193,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,107 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+// Recolección y limpieza de los datos enviados por POST\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+// Expresiones regulares para validar correo y contraseña segura\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+// Verifica que ningún campo esté vacío\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+// Verifica que las contraseñas coincidan\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida el formato del correo\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida la fortaleza de la contraseña\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>La Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+// Verifica si el correo ya está registrado como Adoptante\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+// Hashea la contraseña antes de almacenarla\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+// Inserta el nuevo usuario en la tabla Refugio\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+// Si el registro fue exitoso:\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+// Envía correo de bienvenida\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+    // Muestra página de confirmación\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346598720,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,108 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+}catch (PDOException $e){\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage(); \r\n+}\r\n+// Recolección y limpieza de los datos enviados por POST\r\n+$nombre= trim($_POST['nombre']);\r\n+$ciudad= trim($_POST['ciudad']);\r\n+$correo= trim($_POST['correo']);\r\n+$contrasena= trim($_POST['contrasena']);\r\n+$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n+// Expresiones regulares para validar correo y contraseña segura\r\n+$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n+// Verifica que ningún campo esté vacío\r\n+$valido_correo= preg_match($requisitos_correo,$correo);\r\n+$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\n+if(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+// Verifica que las contraseñas coincidan\r\n+if ($contrasena !== $confirmar_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida el formato del correo\r\n+if (!$valido_correo){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida la fortaleza de la contraseña\r\n+if (!$valido_contrasena){\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>La Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+// Verifica si el correo ya está registrado como Adoptante\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate ->bindParam(':correo', $correo);\r\n+$registros_adoptate ->execute();\r\n+// Hashea la contraseña antes de almacenarla\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+// Inserta el nuevo usuario en la tabla Refugio\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora ->bindParam(':correo', $correo);\r\n+$registros_protectora ->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios ->bindParam(':correo', $correo);\r\n+$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios ->execute();\r\n+// Si el registro fue exitoso:\r\n+if ($registrar_usuarios){\r\n+setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+setcookie(\"nombre\",$nombre, time() + (3600), \"/\");\r\n+// Envía correo de bienvenida\r\n+include 'mail_registro.php';\r\n+enviarCorreosregistro($correo,$nombre);\r\n+    // Muestra página de confirmación\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+            exit;\r\n+}else{\r\n+      // Si algo falla en la inserción\r\n+   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n+   exit;\r\n+}\r\n+?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747346616356,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,107 @@\n+<?php\r\n+ini_set('display_errors', 1);\r\n+\r\n+ini_set('display_startup_errors', 1);\r\n+\r\n+error_reporting(E_ALL);\r\n+// Conexión a la base de datos usando PDO\r\n+try {\r\n+    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n+    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n+} catch (PDOException $e) {\r\n+    // Conexión a la base de datos usando PDO\r\n+    echo 'Falló la conexión: ' . $e->getMessage();\r\n+}\r\n+// Recolección y limpieza de los datos enviados por POST\r\n+$nombre = trim($_POST['nombre']);\r\n+$ciudad = trim($_POST['ciudad']);\r\n+$correo = trim($_POST['correo']);\r\n+$contrasena = trim($_POST['contrasena']);\r\n+$confirmar_contrasena = trim($_POST['confirmar_contrasena']);\r\n+// Expresiones regulares para validar correo y contraseña segura\r\n+$requisitos_correo = \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n+$requisitos_contrasena = \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\";\r\n+// Verifica que ningún campo esté vacío\r\n+$valido_correo = preg_match($requisitos_correo, $correo);\r\n+$valido_contrasena = preg_match($requisitos_contrasena, $contrasena);\r\n+if (empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Por favor, no dejes ningun hueco vacio en el formulario<div class='error'>\";\r\n+    exit;\r\n+}\r\n+// Verifica que las contraseñas coincidan\r\n+if ($contrasena !== $confirmar_contrasena) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Las contraseñas no coinciden.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida el formato del correo\r\n+if (!$valido_correo) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>El correo no es válido.</div>\";\r\n+    exit;\r\n+}\r\n+// Valida la fortaleza de la contraseña\r\n+if (!$valido_contrasena) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>La Contraseña no es valido.</div>\";\r\n+    exit;\r\n+}\r\n+// Verifica si el correo ya está registrado como Adoptante\r\n+$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n+$registros_adoptate->bindParam(':correo', $correo);\r\n+$registros_adoptate->execute();\r\n+// Hashea la contraseña antes de almacenarla\r\n+if ($registros_adoptate->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, inténtalo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+// Inserta el nuevo usuario en la tabla Refugio\r\n+$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n+$registros_protectora->bindParam(':correo', $correo);\r\n+$registros_protectora->execute();\r\n+\r\n+if ($registros_protectora->rowCount() > 0) {\r\n+    echo \"<link rel='stylesheet' href='./Css_Paginas/Errores.css'>\r\n+    <div class='error'>Este correo ya esta registrado, por favor, intelo con otro correo</div>\";\r\n+    exit;\r\n+}\r\n+//hashear pass\r\n+$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n+$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n+$registrar_usuarios->bindParam(':nombre', $nombre);\r\n+$registrar_usuarios->bindParam(':correo', $correo);\r\n+$registrar_usuarios->bindParam(':ciudad', $ciudad);\r\n+$registrar_usuarios->bindParam(':contrasena', $contrasena_hasheada);\r\n+$registrar_usuarios->execute();\r\n+// Si el registro fue exitoso:\r\n+if ($registrar_usuarios) {\r\n+    setcookie(\"rol\", \"protectora\", time() + (3600), \"/\");\r\n+    setcookie(\"nombre\", $nombre, time() + (3600), \"/\");\r\n+    // Envía correo de bienvenida\r\n+    include 'mail_registro.php';\r\n+    enviarCorreosregistro($correo, $nombre);\r\n+    // Muestra página de confirmación\r\n+    echo '<!DOCTYPE html>\r\n+            <html lang=\"es\">\r\n+                <head>\r\n+                    <meta charset=\"UTF-8\">\r\n+                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n+                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n+                    <title>Registro Exitoso</title>\r\n+                </head>\r\n+                <body class=\"cuerpo\">\r\n+                    <div class=\"alertas\">\r\n+                        <h1>Registro Exitoso</h1>\r\n+                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n+                    </div>\r\n+                </body>\r\n+            </html>\r\n+            ';\r\n+    exit;\r\n+} else {\r\n+    // Si algo falla en la inserción\r\n+    echo \"Error al registrar usuario: \" . $db->errorInfo()[2];\r\n+    exit;\r\n+}\r\n"
                }
            ],
            "date": 1747231151086,
            "name": "Commit-0",
            "content": "<?php\r\nini_set('display_errors', 1);\r\n\r\nini_set('display_startup_errors', 1);\r\n\r\nerror_reporting(E_ALL);\r\ntry {\r\n    $db = new PDO('mysql:host=localhost;dbname=protectora', 'petlove', 'mascota');\r\n    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n}catch (PDOException $e){\r\n    echo 'Falló la conixion: ' . $e->getMessage(); \r\n}\r\n/*$servername = 'localhost'; // este sera el nombre de nuestro servidor\r\n$database = 'protectora'; // nombre bd\r\n$username = 'petlove'; // Usuario bd\r\n$password = 'mascota'; // pass base de datos\r\n// creamos conexion\r\n//if (function_exists('mysqli_connect')){\r\n//    echo \"mysqli yes\";\r\n//}\r\n//echo \"intentamos conexion\" . $servername . $database.$username.$password;\r\n$conn = new mysqli($servername, $username, $password, $database);\r\n//verificamos la conexion\r\n//echo \"este no se muestra\";\r\nif ($conn->connect_errno){\r\n    echo 'fallo al conectar';\r\n    die(\"Conexion fallida: \". $conn->connect_error);\r\n}*/\r\n$nombre= trim($_POST['nombre']);\r\n$ciudad= trim($_POST['ciudad']);\r\n$correo= trim($_POST['correo']);\r\n$contrasena= trim($_POST['contrasena']);\r\n$confirmar_contrasena= trim($_POST['confirmar_contrasena']);\r\n$requisitos_correo= \"/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._%+-]+\\.[a-zA-Z]{2,}$/\";\r\n$requisitos_contrasena= \"/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[a-zA-Z\\d@$!%*?&]{8,}$/\" ;\r\n//revisar que los campos no sean null\r\n//echo $dni.\" \".$correo;\r\n$valido_correo= preg_match($requisitos_correo,$correo);\r\n$valido_contrasena= preg_match($requisitos_contrasena,$contrasena);\r\nif(empty($nombre) || empty($ciudad) || empty($correo) || empty($contrasena) || empty($confirmar_contrasena)){\r\n    echo \"Por favor, no dejes ningun hueco vacio en el formulario\";\r\n    exit;\r\n}\r\n//verificar las contraseñas que sean iguales\r\nif ($contrasena !== $confirmar_contrasena){\r\n    echo \"Las cotraseñas no coinciden.\";\r\n    exit;\r\n}\r\n\r\nif (!$valido_correo){\r\n    echo \"El Correo no es valido.\";\r\n    exit;\r\n}\r\nif (!$valido_contrasena){\r\n    echo \"El Contraseña no es valido.\";\r\n    exit;\r\n}\r\n//verificar si el mail esta registrado\r\n$registros_adoptate = $db->prepare(\"SELECT * FROM Adoptante WHERE Correo = :correo\");\r\n$registros_adoptate ->bindParam(':correo', $correo);\r\n$registros_adoptate ->execute();\r\n//$verificar_correo_usuario = \"SELECT * FROM adoptante WHERE Correo = '$correo'\";\r\n//$correo_verificado_usuario = mysqli_query($conn, $verificar_correo_usuario);\r\n//if (mysqli_num_rows($correo_verificado_usuario)>0){\r\nif ($registros_adoptate->rowCount() > 0) {\r\n    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n    exit;\r\n}\r\n$registros_protectora = $db->prepare(\"SELECT * FROM Refugio WHERE Correo = :correo\");\r\n$registros_protectora ->bindParam(':correo', $correo);\r\n$registros_protectora ->execute();\r\n//$verificar_correo_protectora = \"SELECT * FROM refugio WHERE Correo = '$correo'\";\r\n//$correo_verificado_protectora = mysqli_query($conn, $verificar_correo_protectora);\r\n//if (mysqli_num_rows($correo_verificado_protectora)>0){\r\nif ($registros_protectora->rowCount() > 0) {\r\n    echo \"Este correo ya esta registrado, por favor, intelo con otro correo\";\r\n    exit;\r\n}\r\n//hashear pass\r\n$contrasena_hasheada = password_hash($contrasena, PASSWORD_DEFAULT);\r\n$registrar_usuarios = $db->prepare(\"INSERT INTO Refugio (Nombre, Ciudad, Correo, Contraseña) VALUES (:nombre,:ciudad,:correo,:contrasena)\");\r\n$registrar_usuarios ->bindParam(':nombre', $nombre);\r\n$registrar_usuarios ->bindParam(':correo', $correo);\r\n$registrar_usuarios ->bindParam(':ciudad', $ciudad);\r\n$registrar_usuarios ->bindParam(':contrasena', $contrasena_hasheada);\r\n$registrar_usuarios ->execute();\r\n//$registrar_usuarios = \"INSERT INTO adoptante (DNI, Nombre, Telefono, Correo, Contraseña) VALUES ('$dni', '$nombre','$telefono','$correo','$contrasena_hasheada');\";\r\nif ($registrar_usuarios){\r\nsetcookie(\"rol\", \"protectora\", time() + (86400 * 30), \"/\");\r\nsetcookie(\"nombre\",$nombre, time() + (86400 * 30), \"/\");\r\ninclude 'mail_registro.php';\r\nenviarCorreosregistro($correo,$nombre);\r\n//if (mysqli_query($conn, $registrar_usuarios)){\r\n    echo '<!DOCTYPE html>\r\n            <html lang=\"es\">\r\n                <head>\r\n                    <meta charset=\"UTF-8\">\r\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n                    <link rel=\"stylesheet\" href=\"./Css_Paginas/insertar_datos_registro.css\">\r\n                    <title>Registro Exitoso</title>\r\n                </head>\r\n                <body class=\"cuerpo\">\r\n                    <div class=\"alertas\">\r\n                        <h1>Registro Exitoso</h1>\r\n                        <a href=\"Home_Petlover.php\"> Ir al inicio</a>\r\n                    </div>\r\n                </body>\r\n            </html>\r\n            ';\r\n            exit;\r\n}else{\r\n   echo \"Error al registrar usuario: \". $db->errorInfo()[2];\r\n   exit;\r\n}\r\n?>"
        }
    ]
}